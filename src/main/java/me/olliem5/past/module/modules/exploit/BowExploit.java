package me.olliem5.past.module.modules.exploit;

import me.olliem5.past.Past;
import me.olliem5.past.event.events.PacketEvent;
import me.olliem5.past.module.Category;
import me.olliem5.past.module.Module;
import me.olliem5.past.settings.Setting;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.item.ItemBow;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerTryUseItem;

public class BowExploit extends Module {
    public BowExploit() {
        super("BowExploit", "Makes you hit yourself with arrows while shooting", Category.EXPLOIT);
    }

    /**
     * If you have velocity on, hitting
     * yourself with a lot of arrows breaks NCP,
     * and allows you to do some wacky movement.
     *
     * Also, a strange hover thing if you use
     * vanilla fly and stay with solid blocks
     * under you.
     *
     * https://cdn.discordapp.com/attachments/754619445489565788/778941240472371240/past_2bpvp_hover.mp4
     */

    Setting usecustompitch;
    Setting custompitch;

    @Override
    public void setup() {
        Past.settingsManager.registerSetting(usecustompitch = new Setting("Use Custom Pitch", "BowExploitUseCustomPitch", false, this));
        Past.settingsManager.registerSetting(custompitch = new Setting("Custom Pitch", "BowExploitCustomPitch", -90, -90, 90, this));
    }

    @EventHandler
    public Listener<PacketEvent.Send> listener = new Listener<>(event -> {
        if (event.getPacket() instanceof CPacketPlayerTryUseItem && mc.player.getHeldItemMainhand().getItem() instanceof ItemBow) {
            if (usecustompitch.getValBoolean()) {
                mc.player.connection.sendPacket(new CPacketPlayer.Rotation(mc.player.rotationYaw, custompitch.getValueInt(), mc.player.onGround));
            } else {
                mc.player.connection.sendPacket(new CPacketPlayer.Rotation(mc.player.rotationYaw, -90.0f, mc.player.onGround));
            }
        }
    });
}
